{% extends "base.html" %}

{% block content %}
<div class="max-w-2xl mx-auto bg-white p-8 border border-gray-200">
    <h2 class="text-2xl font-bold uppercase tracking-wide border-b border-gray-200 pb-4 mb-6">Place Your Order</h2>

    <form action="" method="post" id="orderForm" class="space-y-6">
        {% csrf_token %}
        
        <div class="
            [&_label]:block [&_label]:text-xs [&_label]:font-bold [&_label]:uppercase [&_label]:text-gray-500 [&_label]:mb-1
            [&_input]:w-full [&_input]:p-3 [&_input]:bg-gray-50 [&_input]:border [&_input]:border-gray-200 [&_input]:rounded-none [&_input]:focus:border-primary [&_input]:focus:ring-0 [&_input]:transition-colors
            [&_select]:w-full [&_select]:p-3 [&_select]:bg-gray-50 [&_select]:border [&_select]:border-gray-200 [&_select]:rounded-none
            [&_textarea]:w-full [&_textarea]:p-3 [&_textarea]:bg-gray-50 [&_textarea]:border [&_textarea]:border-gray-200
            [&_.errors]:text-red-500 [&_.errors]:text-sm [&_.errors]:mt-1
        ">
        
            {% if is_authenticated %}
            <div class="form-group mb-8 p-4 bg-gray-50 border border-dashed border-gray-300">
                <label for="{{ form.existing_address.id_for_label }}">Select Saved Address:</label>
                {{ form.existing_address }}
                {% if form.existing_address.errors %}
                    <div class="errors">{{ form.existing_address.errors }}</div>
                {% endif %}
            </div>
            {% endif %}
            
            <h3 class="text-lg font-bold text-secondary pt-4">Shipping Address</h3>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="form-group">
                    <label for="{{ form.first_name.id_for_label }}">First Name *</label>
                    {{ form.first_name }}
                    {% if form.first_name.errors %} <div class="errors">{{ form.first_name.errors }}</div> {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.last_name.id_for_label }}">Last Name *</label>
                    {{ form.last_name }}
                    {% if form.last_name.errors %} <div class="errors">{{ form.last_name.errors }}</div> {% endif %}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ form.address1.id_for_label }}">Address Line 1 *</label>
                {{ form.address1 }}
                {% if form.address1.errors %} <div class="errors">{{ form.address1.errors }}</div> {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.address2.id_for_label }}">Address Line 2</label>
                {{ form.address2 }}
                {% if form.address2.errors %} <div class="errors">{{ form.address2.errors }}</div> {% endif %}
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="form-group">
                    <label for="{{ form.city.id_for_label }}">City *</label>
                    {{ form.city }}
                    {% if form.city.errors %} <div class="errors">{{ form.city.errors }}</div> {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.state.id_for_label }}">State *</label>
                    {{ form.state }}
                    {% if form.state.errors %} <div class="errors">{{ form.state.errors }}</div> {% endif %}
                </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div class="form-group">
                    <label for="{{ form.postal_code.id_for_label }}">Postal Code *</label>
                    {{ form.postal_code }}
                    {% if form.postal_code.errors %} <div class="errors">{{ form.postal_code.errors }}</div> {% endif %}
                </div>
                
                <div class="form-group">
                    <label for="{{ form.country.id_for_label }}">Country *</label>
                    {{ form.country }}
                    {% if form.country.errors %} <div class="errors">{{ form.country.errors }}</div> {% endif %}
                </div>
            </div>
            
            <div class="form-group">
                <label for="{{ form.phone.id_for_label }}">Phone *</label>
                {{ form.phone }}
                {% if form.phone.errors %} <div class="errors">{{ form.phone.errors }}</div> {% endif %}
            </div>
            
            <div class="form-group">
                <label for="{{ form.special_instructions.id_for_label }}">Special Instructions</label>
                {{ form.special_instructions }}
                {% if form.special_instructions.errors %} <div class="errors">{{ form.special_instructions.errors }}</div> {% endif %}
            </div>
            
            <h3 class="text-lg font-bold text-secondary pt-4 border-t border-gray-100">Payment</h3>
            
            <div class="form-group">
                <label for="{{ form.payment_provider.id_for_label }}">Payment Provider</label>
                {{ form.payment_provider }}
                {% if form.payment_provider.errors %}
                    <div class="errors">{{ form.payment_provider.errors }}</div>
                {% endif %}
            </div>
        </div>
        
        <input type="submit" value="Place Order" class="w-full bg-dark text-white font-bold py-4 text-lg hover:bg-primary hover:text-dark transition-colors duration-200 cursor-pointer uppercase tracking-widest mt-8">
    </form>
</div>

{% if is_authenticated %}
<script>
    // ... (Keep existing JS for address auto-fill) ...
    document.addEventListener('DOMContentLoaded', function() {
        const existingAddressSelect = document.getElementById('id_existing_address');
        const addressData = {};
        
        {% for address in form.existing_address.field.queryset %}
        addressData[{{ address.id }}] = {
            first_name: "{{ address.first_name|escapejs }}",
            last_name: "{{ address.last_name|escapejs }}",
            address1: "{{ address.address1|escapejs }}",
            address2: "{{ address.address2|escapejs }}",
            city: "{{ address.city|escapejs }}",
            state: "{{ address.state|escapejs }}",
            postal_code: "{{ address.postal_code|escapejs }}",
            country: "{{ address.country|escapejs }}",
            phone: "{{ address.phone|escapejs }}",
            special_instructions: "{{ address.special_instructions|escapejs }}"
        };
        {% endfor %}
        
        existingAddressSelect.addEventListener('change', function() {
            const selectedId = this.value;
            if (selectedId && addressData[selectedId]) {
                const address = addressData[selectedId];
                document.getElementById('id_first_name').value = address.first_name;
                document.getElementById('id_last_name').value = address.last_name;
                document.getElementById('id_address1').value = address.address1;
                document.getElementById('id_address2').value = address.address2;
                document.getElementById('id_city').value = address.city;
                document.getElementById('id_state').value = address.state;
                document.getElementById('id_postal_code').value = address.postal_code;
                document.getElementById('id_country').value = address.country;
                document.getElementById('id_phone').value = address.phone;
                document.getElementById('id_special_instructions').value = address.special_instructions;
            }
        });
    });
</script>
{% endif %}
{% endblock content %}