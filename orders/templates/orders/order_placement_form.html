{% extends "base.html" %}

{% block content %}
<div class="container mx-auto px-6 py-16">
    <div class="max-w-3xl mx-auto bg-white border border-gray-900 p-8">
        <h1 class="text-3xl font-bold uppercase tracking-tight mb-8 pb-6 border-b border-gray-900">
            Place Your Order
        </h1>
        
        <form action="" method="post" id="orderForm" class="space-y-8">
            {% csrf_token %}
            
            {% if is_authenticated %}
            <div class="form-group">
                <label for="{{ form.existing_address.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                    Select Existing Address
                </label>
                {{ form.existing_address }}
                {% if form.existing_address.errors %}
                    <div class="errors text-red-600 text-sm mt-2">{{ form.existing_address.errors }}</div>
                {% endif %}
            </div>
            {% endif %}
            
            <div class="border-t border-gray-900 pt-8">
                <h2 class="text-xl font-bold uppercase tracking-tight mb-6">
                    Shipping Address
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="form-group">
                        <label for="{{ form.first_name.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                            First Name *
                        </label>
                        {{ form.first_name }}
                        {% if form.first_name.errors %}
                            <div class="errors text-red-600 text-sm mt-2">{{ form.first_name.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.last_name.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                            Last Name *
                        </label>
                        {{ form.last_name }}
                        {% if form.last_name.errors %}
                            <div class="errors text-red-600 text-sm mt-2">{{ form.last_name.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-group mt-6">
                    <label for="{{ form.address1.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                        Address Line 1 *
                    </label>
                    {{ form.address1 }}
                    {% if form.address1.errors %}
                        <div class="errors text-red-600 text-sm mt-2">{{ form.address1.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group mt-6">
                    <label for="{{ form.address2.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                        Address Line 2
                    </label>
                    {{ form.address2 }}
                    {% if form.address2.errors %}
                        <div class="errors text-red-600 text-sm mt-2">{{ form.address2.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div class="form-group">
                        <label for="{{ form.city.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                            City *
                        </label>
                        {{ form.city }}
                        {% if form.city.errors %}
                            <div class="errors text-red-600 text-sm mt-2">{{ form.city.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.state.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                            State *
                        </label>
                        {{ form.state }}
                        {% if form.state.errors %}
                            <div class="errors text-red-600 text-sm mt-2">{{ form.state.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                    <div class="form-group">
                        <label for="{{ form.postal_code.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                            Postal Code *
                        </label>
                        {{ form.postal_code }}
                        {% if form.postal_code.errors %}
                            <div class="errors text-red-600 text-sm mt-2">{{ form.postal_code.errors }}</div>
                        {% endif %}
                    </div>
                    
                    <div class="form-group">
                        <label for="{{ form.country.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                            Country *
                        </label>
                        {{ form.country }}
                        {% if form.country.errors %}
                            <div class="errors text-red-600 text-sm mt-2">{{ form.country.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                
                <div class="form-group mt-6">
                    <label for="{{ form.phone.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                        Phone *
                    </label>
                    {{ form.phone }}
                    {% if form.phone.errors %}
                        <div class="errors text-red-600 text-sm mt-2">{{ form.phone.errors }}</div>
                    {% endif %}
                </div>
                
                <div class="form-group mt-6">
                    <label for="{{ form.special_instructions.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                        Special Instructions
                    </label>
                    {{ form.special_instructions }}
                    {% if form.special_instructions.errors %}
                        <div class="errors text-red-600 text-sm mt-2">{{ form.special_instructions.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <div class="border-t border-gray-900 pt-8">
                <h2 class="text-xl font-bold uppercase tracking-tight mb-6">
                    Payment
                </h2>
                
                <div class="form-group">
                    <label for="{{ form.payment_provider.id_for_label }}" class="block text-sm font-bold uppercase tracking-wide text-gray-600 mb-2">
                        Payment Provider
                    </label>
                    {{ form.payment_provider }}
                    {% if form.payment_provider.errors %}
                        <div class="errors text-red-600 text-sm mt-2">{{ form.payment_provider.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <button type="submit" class="w-full px-8 py-4 bg-accent text-white font-bold uppercase tracking-wide hover:bg-gray-900 transition-colors text-lg">
                Place Order
            </button>
        </form>
    </div>
</div>

<style>
    form input[type="text"],
    form input[type="tel"],
    form select,
    form textarea {
        width: 100%;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        background-color: #f9fafb;
        font-size: 0.875rem;
        transition: all 0.2s;
    }
    
    form input[type="text"]:focus,
    form input[type="tel"]:focus,
    form select:focus,
    form textarea:focus {
        outline: none;
        border-color: #10b981;
        background-color: white;
    }
    
    form textarea {
        min-height: 100px;
        resize: vertical;
    }
</style>

{% if is_authenticated %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const existingAddressSelect = document.getElementById('id_existing_address');
    const addressFields = [
        'id_first_name', 'id_last_name', 'id_address1', 'id_address2',
        'id_city', 'id_state', 'id_postal_code', 'id_country', 
        'id_phone', 'id_special_instructions'
    ];
    
    // Store address data in the select options
    const addressData = {};
    
    {% for address in form.existing_address.field.queryset %}
    addressData[{{ address.id }}] = {
        first_name: "{{ address.first_name|escapejs }}",
        last_name: "{{ address.last_name|escapejs }}",
        address1: "{{ address.address1|escapejs }}",
        address2: "{{ address.address2|escapejs }}",
        city: "{{ address.city|escapejs }}",
        state: "{{ address.state|escapejs }}",
        postal_code: "{{ address.postal_code|escapejs }}",
        country: "{{ address.country|escapejs }}",
        phone: "{{ address.phone|escapejs }}",
        special_instructions: "{{ address.special_instructions|escapejs }}"
    };
    {% endfor %}
    
    existingAddressSelect.addEventListener('change', function() {
        const selectedId = this.value;
        
        if (selectedId && addressData[selectedId]) {
            // Populate fields with selected address
            const address = addressData[selectedId];
            document.getElementById('id_first_name').value = address.first_name;
            document.getElementById('id_last_name').value = address.last_name;
            document.getElementById('id_address1').value = address.address1;
            document.getElementById('id_address2').value = address.address2;
            document.getElementById('id_city').value = address.city;
            document.getElementById('id_state').value = address.state;
            document.getElementById('id_postal_code').value = address.postal_code;
            document.getElementById('id_country').value = address.country;
            document.getElementById('id_phone').value = address.phone;
            document.getElementById('id_special_instructions').value = address.special_instructions;
        } else {
            // Clear fields for new address
            addressFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.value = '';
                }
            });
        }
    });
});
</script>
{% endif %}
{% endblock content %}