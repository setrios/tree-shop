{% extends "base.html" %}
{% block content %}
<main class="container mx-auto px-6 py-16">
    <div class="max-w-5xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-12 bg-white border border-gray-900 p-8">
            <!-- Product Image -->
            <div class="border border-gray-200">
                <img src="{{ tree.image.url }}" alt="{{ tree.name }}" class="w-full h-auto">
            </div>
            
            <!-- Product Details -->
            <div class="flex flex-col">
                <h1 class="text-4xl font-bold uppercase tracking-tight mb-6">
                    {{ tree.name }}
                </h1>
                
                <div class="space-y-4 mb-8 text-sm">
                    <div class="flex border-b border-gray-100 pb-3">
                        <span class="font-bold uppercase tracking-wide text-gray-600 w-32">Type</span>
                        <span class="text-gray-900">{{ tree.tree_type }}</span>
                    </div>
                    
                    <div class="flex border-b border-gray-100 pb-3">
                        <span class="font-bold uppercase tracking-wide text-gray-600 w-32">Color</span>
                        <span class="text-gray-900">{{ tree.color }}</span>
                    </div>
                    
                    <div class="flex border-b border-gray-100 pb-3">
                        <span class="font-bold uppercase tracking-wide text-gray-600 w-32">Decorations</span>
                        <span class="text-gray-900">
                            {% for deco in tree.decorations.all %}
                                {{ deco.name }}{% if not forloop.last %}, {% endif %}
                            {% empty %}
                                No decorations
                            {% endfor %}
                        </span>
                    </div>
                    
                    <div class="flex border-b border-gray-100 pb-3">
                        <span class="font-bold uppercase tracking-wide text-gray-600 w-32">Height</span>
                        <span class="text-gray-900">{{ tree.height }}</span>
                    </div>
                    
                    <div class="flex border-b border-gray-100 pb-3">
                        <span class="font-bold uppercase tracking-wide text-gray-600 w-32">Material</span>
                        <span class="text-gray-900">{% if tree.artificial %}Artificial{% else %}Real{% endif %}</span>
                    </div>
                </div>
                
                <div class="mb-8">
                    <p class="text-5xl font-bold text-gray-900 mb-6">${{ tree.price }}</p>
                    <button value="{{ tree.id }}" id="add-cart" class="w-full px-8 py-4 bg-accent text-white font-bold uppercase tracking-wide hover:bg-gray-900 transition-colors text-lg">
                        Add To Cart
                    </button>
                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                </div>
                
                <div class="mt-auto">
                    <h3 class="text-sm font-bold uppercase tracking-wide text-gray-600 mb-3">Description</h3>
                    <p class="text-gray-700 leading-relaxed">{{ tree.description }}</p>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- sending AJAX with vanilla JS -->
<script type="text/javascript">
    function updateHeaderCartCount(cartHeaderId, quantity)
    {
        const cartHeader = document.getElementById(cartHeaderId);
        if (!cartHeader) {
            console.error('Cart element not found by id: ', cartHeaderId);
            return;
        }
        cartHeader.textContent = `Cart (${quantity})`
    }
    document.getElementById('add-cart').addEventListener('click', function(e) {
        e.preventDefault();
        const formData = new FormData();
        formData.append('product_id', this.value);
        formData.append('csrfmiddlewaretoken', document.querySelector('input[name=csrfmiddlewaretoken]').value);
        formData.append('action', 'post');
        fetch('{% url "cart:cart_add" %}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(json => {
            if (json.success) {
                updateHeaderCartCount('cart-header', json.cart_count);
            } 
            else {
                console.error('Error adding to cart:', json.error);
            }
        })
        .catch(error => console.error(error));
    });
</script>
{% endblock content %}